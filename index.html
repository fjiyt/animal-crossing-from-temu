<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÎèôÎ¨ºÏùò Ïà≤ Í≤åÏûÑ</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(to bottom, #87CEEB, #90EE90);
            font-family: 'Comic Sans MS', cursive;
            overflow: hidden;
        }
        
        #gameContainer {
            width: 100vw;
            height: 100vh;
            position: relative;
        }
        
        #gameCanvas {
            border: none;
            background: linear-gradient(to bottom, #87CEEB 0%, #90EE90 40%, #32CD32 100%);
        }
        
        #ui {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            font-size: 16px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        #dialogBox {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            max-width: 600px;
            background: rgba(255, 255, 255, 0.9);
            border: 3px solid #8B4513;
            border-radius: 15px;
            padding: 20px;
            display: none;
            box-shadow: 0 0 20px rgba(0,0,0,0.3);
        }
        
        #dialogText {
            font-size: 18px;
            color: #333;
            margin-bottom: 10px;
        }
        
        #dialogOptions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .dialogBtn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .dialogBtn:hover {
            background: #45a049;
        }
        
        #inventory {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 255, 255, 0.8);
            padding: 10px;
            border-radius: 10px;
            border: 2px solid #8B4513;
        }
        
        .fishingUI {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 15px;
            display: none;
            text-align: center;
        }
        
        #fishingBar {
            width: 200px;
            height: 20px;
            background: #ddd;
            border-radius: 10px;
            margin: 10px auto;
            position: relative;
        }
        
        #fishingProgress {
            height: 100%;
            background: #4CAF50;
            border-radius: 10px;
            width: 0%;
            transition: width 0.1s;
        }
        
        .buildingUI {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            display: none;
            text-align: center;
            border: 3px solid #8B4513;
        }
        
        .buildBtn {
            background: #FF6B35;
            color: white;
            border: none;
            padding: 15px 20px;
            margin: 5px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
        }
        
        .buildBtn:hover {
            background: #E5A455;
        }
        
        .mathUI {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            display: none;
            text-align: center;
            border: 3px solid #FF6347;
            min-width: 300px;
        }
        
        #mathQuestion {
            font-size: 24px;
            color: #333;
            margin: 20px 0;
            font-weight: bold;
        }
        
        #mathInput {
            padding: 10px;
            font-size: 18px;
            border: 2px solid #ddd;
            border-radius: 8px;
            width: 100px;
            text-align: center;
            margin: 10px;
        }
        
        .mathBtn {
            background: #FF6347;
            color: white;
            border: none;
            padding: 12px 20px;
            margin: 5px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
        }
        
        .mathBtn:hover {
            background: #FF4500;
        }
        
        #mathResult {
            margin-top: 15px;
            font-size: 16px;
            font-weight: bold;
        }
        
        .correct {
            color: #4CAF50;
        }
        
        .incorrect {
            color: #f44336;
        }
        
        /* Î°úÍ∑∏Ïù∏ Î™®Îã¨ Ïä§ÌÉÄÏùº */
        .login-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .login-container {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 0 30px rgba(0,0,0,0.3);
        }
        
        .login-container h2 {
            color: #333;
            margin-bottom: 30px;
            font-size: 28px;
        }
        
        .character-preview {
            font-size: 60px;
            margin: 20px 0;
            display: block;
        }
        
        .login-input {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            box-sizing: border-box;
        }
        
        .login-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px 30px;
            margin: 10px 5px;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            min-width: 120px;
        }
        
        .login-btn:hover {
            background: #45a049;
        }
        
        .login-btn.secondary {
            background: #2196F3;
        }
        
        .login-btn.secondary:hover {
            background: #1976D2;
        }
        
        .player-info {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 18px;
            border: 2px solid #4CAF50;
        }
        
        .online-players {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: rgba(255, 255, 255, 0.8);
            padding: 10px;
            border-radius: 10px;
            font-size: 14px;
        }
        
        .multiplayer-chat {
            position: absolute;
            bottom: 20px;
            left: 20px;
            width: 300px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 10px;
            display: none;
        }
        
        .multiplayer-chat.active {
            display: block;
        }
        
        .chat-messages {
            height: 150px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 5px;
            margin-bottom: 10px;
            background: white;
            border-radius: 5px;
            font-size: 12px;
        }
        
        .chat-input-container {
            display: flex;
            gap: 5px;
        }
        
        .chat-input {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .chat-send-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .chat-message {
            margin: 3px 0;
            padding: 2px 5px;
            border-radius: 3px;
        }
        
        .chat-message.own {
            background: #e8f5e8;
            text-align: right;
        }
        
        .chat-message.other {
            background: #f0f0f0;
        }
    </style>
</head>
<body>
    <!-- Î°úÍ∑∏Ïù∏ Î™®Îã¨ -->
    <div id="loginModal" class="login-modal">
        <div class="login-container">
            <h2>üéÆ ÎèôÎ¨ºÏùò Ïà≤Ïóê Ïò§Ïã† Í≤ÉÏùÑ ÌôòÏòÅÌï©ÎãàÎã§!</h2>
            <div class="character-preview" id="characterPreview">üßö‚Äç‚ôÄÔ∏è</div>
            <input type="text" id="usernameInput" class="login-input" placeholder="ÏÇ¨Ïö©Ïûê Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî" maxlength="12">
            <div>
                <button class="login-btn secondary" onclick="randomizeCharacter()">Ï∫êÎ¶≠ÌÑ∞ Î∞îÍæ∏Í∏∞</button>
                <button class="login-btn" onclick="login()">Í≤åÏûÑ ÏãúÏûë!</button>
            </div>
        </div>
    </div>

    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>
        
        <!-- ÌîåÎ†àÏù¥Ïñ¥ Ï†ïÎ≥¥ ÌëúÏãú -->
        <div id="playerInfo" class="player-info" style="display: none;">
            <span id="playerDisplay"></span>
        </div>
        
        <!-- Ïò®ÎùºÏù∏ ÌîåÎ†àÏù¥Ïñ¥ Ïàò -->
        <div id="onlinePlayersCount" class="online-players">
            Ïò®ÎùºÏù∏: 1Î™Ö
        </div>
        
        <!-- Î©ÄÌã∞ÌîåÎ†àÏù¥Ïñ¥ Ï±ÑÌåÖ -->
        <div id="multiplayerChat" class="multiplayer-chat">
            <div class="chat-messages" id="chatMessages"></div>
            <div class="chat-input-container">
                <input type="text" id="multiChatInput" class="chat-input" placeholder="Î©îÏãúÏßÄÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî..." maxlength="100">
                <button class="chat-send-btn" onclick="sendMultiplayerMessage()">Ï†ÑÏÜ°</button>
            </div>
        </div>
        
        <div id="ui">
            <div>üßö‚Äç‚ôÄÔ∏è ÏöîÏ†ïÏùò ÎèôÎ¨ºÏπúÍµ¨Îì§ (Î©ÄÌã∞ÌîåÎ†àÏù¥Ïñ¥)</div>
            <div>WASDÎ°ú Ïù¥Îèô, EÎ°ú ÏÉÅÌò∏ÏûëÏö©, FÎ°ú ÏàòÌôï, CÎ°ú ÎÇòÎ¨¥Î≤†Í∏∞, TÎ°ú Ï±ÑÌåÖ</div>
        </div>
        
        <div id="inventory">
            <h3>Í∞ÄÎ∞©</h3>
            <div id="inventoryItems">
                <div>üêü Î¨ºÍ≥†Í∏∞: <span id="fishCount">0</span></div>
                <div>ü™µ ÎÇòÎ¨¥: <span id="woodCount">0</span></div>
                <div>ü•ï ÎãπÍ∑º: <span id="carrotCount">0</span></div>
                <div>üçé ÏÇ¨Í≥º: <span id="appleCount">0</span></div>
                <div>üçä Ïò§Î†åÏßÄ: <span id="orangeCount">0</span></div>
                <div>ü™ô ÏΩîÏù∏: <span id="coinCount">0</span></div>
                <div>üè¶ ÏùÄÌñâ: <span id="bankBalance">0</span></div>
            </div>
        </div>
        
        <div id="dialogBox">
            <div id="dialogText"></div>
            <div id="dialogOptions"></div>
        </div>
        
        <div id="fishingUI" class="fishingUI">
            <h3>ÎÇöÏãú Ï§ë...</h3>
            <div>Ïä§ÌéòÏù¥Ïä§Î∞îÎ•º ÎàåÎü¨ Î¨ºÍ≥†Í∏∞Î•º Ïû°ÏúºÏÑ∏Ïöî!</div>
            <div id="fishingBar">
                <div id="fishingProgress"></div>
            </div>
            <button onclick="game.stopFishing()">Í∑∏ÎßåÌïòÍ∏∞</button>
        </div>
        
        <div id="buildingUI" class="buildingUI">
            <h3>Ïßë Í±¥ÏÑ§</h3>
            <p>Î¨¥ÏóáÏùÑ Í±¥ÏÑ§ÌïòÏãúÍ≤†ÏäµÎãàÍπå?</p>
            <button class="buildBtn" onclick="game.buildHouse('small')">ÏûëÏùÄ Ïßë (ÎÇòÎ¨¥ 5Í∞ú)</button>
            <button class="buildBtn" onclick="game.buildHouse('big')">ÌÅ∞ Ïßë (ÎÇòÎ¨¥ 10Í∞ú)</button>
            <button class="buildBtn" onclick="game.closeBuildingUI()">Ï∑®ÏÜå</button>
        </div>
        
        <div id="mathUI" class="mathUI">
            <h3>üêï Í∞ïÏïÑÏßÄÏùò ÏàòÌïô Î¨∏Ï†ú</h3>
            <p>Î¨∏Ï†úÎ•º ÌíÄÍ≥† ÎÇòÎ¨¥Î•º Î∞õÏïÑÎ≥¥ÏÑ∏Ïöî!</p>
            <div id="mathQuestion"></div>
            <input type="number" id="mathInput" placeholder="ÎãµÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
            <div>
                <button class="mathBtn" onclick="game.checkMathAnswer()">Ï†úÏ∂ú</button>
                <button class="mathBtn" onclick="game.closeMathUI()">ÎÇòÏ§ëÏóê</button>
            </div>
            <div id="mathResult"></div>
        </div>
        
        <div id="triviaUI" class="mathUI">
            <h3>üê± Í≥†ÏñëÏù¥Ïùò ÏÉÅÏãù Î¨∏Ï†ú</h3>
            <p>Î¨∏Ï†úÎ•º ÌíÄÍ≥† ÏÉùÏÑ†ÏùÑ Î∞õÏïÑÎ≥¥ÏÑ∏Ïöî!</p>
            <div id="triviaQuestion"></div>
            <div id="triviaOptions"></div>
            <div id="triviaResult"></div>
        </div>
        
        <div id="riddleUI" class="mathUI">
            <h3>üê∞ ÌÜ†ÎÅºÏùò Í≥ºÌïô ÌÄ¥Ï¶à</h3>
            <p>Î¨∏Ï†úÎ•º ÌíÄÍ≥† ÎãπÍ∑ºÏùÑ Î∞õÏïÑÎ≥¥ÏÑ∏Ïöî!</p>
            <div id="riddleQuestion"></div>
            <input type="text" id="riddleInput" placeholder="ÎãµÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
            <div>
                <button class="mathBtn" onclick="game.checkRiddleAnswer()">Ï†úÏ∂ú</button>
                <button class="mathBtn" onclick="game.closeRiddleUI()">ÎÇòÏ§ëÏóê</button>
            </div>
            <div id="riddleResult"></div>
        </div>
        
        <div id="shopUI" class="mathUI">
            <h3>üè™ ÏÉÅÏ†ê</h3>
            <p>Î¨¥ÏóáÏùÑ ÌïòÏãúÍ≤†ÏäµÎãàÍπå?</p>
            <div id="shopContent">
                <div style="display: flex; gap: 20px; justify-content: center;">
                    <div style="text-align: center;">
                        <h4>ÌåêÎß§ÌïòÍ∏∞</h4>
                        <button class="mathBtn" onclick="game.sellItem('fish')">üêü Î¨ºÍ≥†Í∏∞ ÌåîÍ∏∞ (5ÏΩîÏù∏)</button>
                        <button class="mathBtn" onclick="game.sellItem('carrot')">ü•ï ÎãπÍ∑º ÌåîÍ∏∞ (3ÏΩîÏù∏)</button>
                        <button class="mathBtn" onclick="game.sellItem('apple')">üçé ÏÇ¨Í≥º ÌåîÍ∏∞ (4ÏΩîÏù∏)</button>
                        <button class="mathBtn" onclick="game.sellItem('orange')">üçä Ïò§Î†åÏßÄ ÌåîÍ∏∞ (4ÏΩîÏù∏)</button>
                    </div>
                    <div style="text-align: center;">
                        <h4>Íµ¨Îß§ÌïòÍ∏∞</h4>
                        <button class="mathBtn" onclick="game.buyItem('wood')">ü™µ ÎÇòÎ¨¥ ÏÇ¨Í∏∞ (8ÏΩîÏù∏)</button>
                        <button class="mathBtn" onclick="game.buyItem('fish')">üêü Î¨ºÍ≥†Í∏∞ ÏÇ¨Í∏∞ (6ÏΩîÏù∏)</button>
                    </div>
                </div>
                <button class="mathBtn" onclick="game.closeShopUI()" style="margin-top: 15px;">ÎÇòÍ∞ÄÍ∏∞</button>
            </div>
            <div id="shopResult"></div>
        </div>
        
        <div id="tradeUI" class="mathUI">
            <h3>ü¶ä Ïó¨Ïö∞Ïùò Î¨ºÎ¨ºÍµêÌôò</h3>
            <p>ÎÇ¥Í∞Ä Í∞ÄÏßÑ Í≤ÉÍ≥º ÎÑ§Í∞Ä Í∞ÄÏßÑ Í≤ÉÏùÑ Î∞îÍøîÎ≥¥Ïûê!</p>
            <div id="tradeContent">
                <div style="display: flex; gap: 20px; justify-content: center;">
                    <div style="text-align: center;">
                        <h4>Ïó¨Ïö∞Í∞Ä ÏõêÌïòÎäî Í≤É</h4>
                        <div id="foxWants"></div>
                    </div>
                    <div style="text-align: center;">
                        <h4>Ïó¨Ïö∞Í∞Ä Ï£ºÎäî Í≤É</h4>
                        <div id="foxOffers"></div>
                    </div>
                </div>
                <div style="margin-top: 15px;">
                    <button class="mathBtn" onclick="game.acceptTrade()">ÍµêÌôòÌïòÍ∏∞</button>
                    <button class="mathBtn" onclick="game.closeTradeUI()">ÎÇòÏ§ëÏóê</button>
                </div>
            </div>
            <div id="tradeResult"></div>
        </div>
        
        <div id="bankUI" class="mathUI">
            <h3>üè¶ ÏöîÏ†ï ÏùÄÌñâ</h3>
            <p>ÎèàÏùÑ Ï†ÄÏ∂ïÌïòÍ≥† Ïù¥ÏûêÎ•º Î∞õÏïÑÎ≥¥ÏÑ∏Ïöî!</p>
            <div id="bankInfo">
                <div style="display: flex; gap: 20px; justify-content: center; margin: 20px 0;">
                    <div>ÌòÑÏû¨ ÏûîÍ≥†: <span id="currentBalance">0</span> ÏΩîÏù∏</div>
                    <div>Ïù¥ÏûêÏú®: 5% (Í≤åÏûÑÏãúÍ∞Ñ 1Î∂ÑÎßàÎã§)</div>
                </div>
            </div>
            <div style="display: flex; gap: 20px; justify-content: center;">
                <div style="text-align: center;">
                    <h4>ÏûÖÍ∏àÌïòÍ∏∞</h4>
                    <input type="number" id="depositAmount" placeholder="ÏûÖÍ∏àÌï† Í∏àÏï°" min="1">
                    <button class="mathBtn" onclick="game.deposit()">ÏûÖÍ∏à</button>
                </div>
                <div style="text-align: center;">
                    <h4>Ï∂úÍ∏àÌïòÍ∏∞</h4>
                    <input type="number" id="withdrawAmount" placeholder="Ï∂úÍ∏àÌï† Í∏àÏï°" min="1">
                    <button class="mathBtn" onclick="game.withdraw()">Ï∂úÍ∏à</button>
                </div>
            </div>
            <div style="margin-top: 15px;">
                <button class="mathBtn" onclick="game.closeBankUI()">ÎÇòÍ∞ÄÍ∏∞</button>
            </div>
            <div id="bankResult"></div>
        </div>
        
        <div id="chatUI" class="mathUI" style="max-width: 600px; height: 500px;">
            <h3>üßô‚Äç‚ôÇÔ∏è ÌòÑÏûêÏôÄÏùò ÎåÄÌôî</h3>
            <p>Í∂ÅÍ∏àÌïú Í≤ÉÏùÑ Î¨¥ÏóáÏù¥Îì† Î¨ºÏñ¥Î≥¥ÏÑ∏Ïöî!</p>
            <div id="chatHistory" style="height: 300px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; margin: 10px 0; background: #f9f9f9; text-align: left;">
                <div style="color: #666; font-style: italic;">ÌòÑÏûê: ÏïàÎÖï! Î¨¥ÏóáÏù¥ Í∂ÅÍ∏àÌïòÎãà?</div>
            </div>
            <div style="display: flex; gap: 10px; margin: 10px 0;">
                <input type="text" id="chatInput" placeholder="ÌòÑÏûêÏóêÍ≤å ÏßàÎ¨∏ÌïòÍ∏∞..." style="flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                <button class="mathBtn" onclick="game.sendChatMessage()" id="chatSendBtn">Ï†ÑÏÜ°</button>
            </div>
            <div style="margin-top: 15px;">
                <button class="mathBtn" onclick="game.closeChatUI()">ÎåÄÌôî Ï¢ÖÎ£å</button>
            </div>
            <div id="chatResult"></div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="game.js"></script>
    
    <script>
        // Í∏ÄÎ°úÎ≤å Î≥ÄÏàò
        let currentPlayer = null;
        let socket = null;
        
        // Ï∫êÎ¶≠ÌÑ∞ Ïù¥Î™®ÏßÄ Î¶¨Ïä§Ìä∏
        const characterEmojis = ['üßö‚Äç‚ôÄÔ∏è', 'üßö‚Äç‚ôÇÔ∏è', 'üë®‚Äçüåæ', 'üë©‚Äçüåæ', 'üßô‚Äç‚ôÄÔ∏è', 'üßô‚Äç‚ôÇÔ∏è', 'üë®‚Äçüé®', 'üë©‚Äçüé®', 'üßù‚Äç‚ôÄÔ∏è', 'üßù‚Äç‚ôÇÔ∏è', 'üë®‚Äçüíº', 'üë©‚Äçüíº'];
        
        // ÎûúÎç§ Ï∫êÎ¶≠ÌÑ∞ ÏÑ†ÌÉù
        function randomizeCharacter() {
            const randomEmoji = characterEmojis[Math.floor(Math.random() * characterEmojis.length)];
            document.getElementById('characterPreview').textContent = randomEmoji;
        }
        
        // Î°úÍ∑∏Ïù∏ Ï≤òÎ¶¨
        function login() {
            const username = document.getElementById('usernameInput').value.trim();
            const emoji = document.getElementById('characterPreview').textContent;
            
            if (!username) {
                alert('ÏÇ¨Ïö©Ïûê Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî!');
                return;
            }
            
            if (username.length < 2) {
                alert('ÏÇ¨Ïö©Ïûê Ïù¥Î¶ÑÏùÄ 2Í∏ÄÏûê Ïù¥ÏÉÅÏù¥Ïñ¥Ïïº Ìï©ÎãàÎã§!');
                return;
            }
            
            currentPlayer = { username, emoji };
            
            // ÏÜåÏºì Ïó∞Í≤∞
            socket = io();
            setupSocketEvents();
            
            // ÏÑúÎ≤ÑÏóê Î°úÍ∑∏Ïù∏ ÏïåÎ¶º
            socket.emit('playerLogin', currentPlayer);
            
            // UI ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('playerInfo').style.display = 'block';
            document.getElementById('playerDisplay').textContent = `${emoji} ${username}`;
            
            // Í≤åÏûÑ Ï¥àÍ∏∞Ìôî
            if (typeof game !== 'undefined') {
                game.currentPlayer = currentPlayer;
                game.socket = socket;
                game.initMultiplayer();
            }
        }
        
        // ÏÜåÏºì Ïù¥Î≤§Ìä∏ ÏÑ§Ï†ï
        function setupSocketEvents() {
            // Í∏∞Ï°¥ ÌîåÎ†àÏù¥Ïñ¥Îì§ Ï†ïÎ≥¥ Î∞õÍ∏∞
            socket.on('existingPlayers', (players) => {
                if (typeof game !== 'undefined') {
                    game.updateOtherPlayers(players.filter(p => p.id !== socket.id));
                }
                updateOnlineCount(players.length);
            });
            
            // ÏÉà ÌîåÎ†àÏù¥Ïñ¥ ÏûÖÏû•
            socket.on('newPlayer', (player) => {
                if (typeof game !== 'undefined') {
                    game.addOtherPlayer(player);
                }
            });
            
            // ÌîåÎ†àÏù¥Ïñ¥ ÏõÄÏßÅÏûÑ ÏóÖÎç∞Ïù¥Ìä∏
            socket.on('playerMoved', (moveData) => {
                if (typeof game !== 'undefined') {
                    game.updateOtherPlayerPosition(moveData);
                }
            });
            
            // ÌîåÎ†àÏù¥Ïñ¥ Ïó∞Í≤∞ Ìï¥Ï†ú
            socket.on('playerDisconnected', (playerId) => {
                if (typeof game !== 'undefined') {
                    game.removeOtherPlayer(playerId);
                }
            });
            
            // Ï±ÑÌåÖ Î©îÏãúÏßÄ Î∞õÍ∏∞
            socket.on('newChatMessage', (chatData) => {
                addChatMessage(chatData);
            });
        }
        
        // Î©ÄÌã∞ÌîåÎ†àÏù¥Ïñ¥ Î©îÏãúÏßÄ Ï†ÑÏÜ°
        function sendMultiplayerMessage() {
            const input = document.getElementById('multiChatInput');
            const message = input.value.trim();
            
            if (message && socket) {
                socket.emit('chatMessage', { message });
                input.value = '';
            }
        }
        
        // Ï±ÑÌåÖ Î©îÏãúÏßÄ Ï∂îÍ∞Ä
        function addChatMessage(chatData) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${chatData.playerId === socket.id ? 'own' : 'other'}`;
            
            const time = new Date(chatData.timestamp).toLocaleTimeString('ko-KR', {
                hour: '2-digit',
                minute: '2-digit'
            });
            
            messageDiv.innerHTML = `<strong>${chatData.username}:</strong> ${chatData.message} <small>(${time})</small>`;
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        // Ïò®ÎùºÏù∏ ÌîåÎ†àÏù¥Ïñ¥ Ïàò ÏóÖÎç∞Ïù¥Ìä∏
        function updateOnlineCount(count) {
            document.getElementById('onlinePlayersCount').textContent = `Ïò®ÎùºÏù∏: ${count}Î™Ö`;
        }
        
        // Ï±ÑÌåÖ ÌÜ†Í∏Ä (TÌÇ§)
        function toggleMultiplayerChat() {
            const chatDiv = document.getElementById('multiplayerChat');
            const isActive = chatDiv.classList.contains('active');
            
            if (isActive) {
                chatDiv.classList.remove('active');
            } else {
                chatDiv.classList.add('active');
                document.getElementById('multiChatInput').focus();
            }
        }
        
        // Enter ÌÇ§Î°ú Î©îÏãúÏßÄ Ï†ÑÏÜ°
        document.getElementById('multiChatInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMultiplayerMessage();
            }
        });
        
        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú ÎûúÎç§ Ï∫êÎ¶≠ÌÑ∞ ÏÑ§Ï†ï
        window.addEventListener('load', () => {
            randomizeCharacter();
        });
    </script>
</body>
</html>